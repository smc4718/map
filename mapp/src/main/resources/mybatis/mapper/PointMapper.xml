<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pyj.mapp.dao.PointMapper">

    <insert id="insertPoint">
        INSERT INTO POINT_T (
            POINT_NO
          , USER_NO
          , ORDER_NO
          , AMOUNT
          , REASON
          , CREATED_AT
        ) VALUES (
            POINT_SEQ.NEXTVAL
          , #{userNo}
          , #{orderNo}
          , #{amount}
          , #{reason}
          , SYSDATE
        )
    </insert>

    <select id="findByUserNo" resultType="PointDto">
        SELECT P.POINT_NO, P.USER_NO, P.ORDER_NO, P.AMOUNT, P.REASON, P.CREATED_AT
          FROM POINT_T P
         WHERE P.USER_NO = #{userNo}
         ORDER BY P.CREATED_AT DESC
    </select>

    <select id="sumPointByUserNo" resultType="int">
        SELECT COALESCE(SUM(AMOUNT), 0)
          FROM POINT_T
         WHERE USER_NO = #{userNo}
    </select>
</mapper>